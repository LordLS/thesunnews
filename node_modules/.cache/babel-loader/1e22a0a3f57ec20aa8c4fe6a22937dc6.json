{"ast":null,"code":"import _regeneratorRuntime from\"/Users/clintonm/Desktop/FS_PROJECT/TheSunNews/backend/thesunnews/frontend/thesunnews/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/clintonm/Desktop/FS_PROJECT/TheSunNews/backend/thesunnews/frontend/thesunnews/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/clintonm/Desktop/FS_PROJECT/TheSunNews/backend/thesunnews/frontend/thesunnews/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import'antd/dist/antd.css';import React,{useEffect,useState}from'react';import{Header,Message,Button,Icon,Loader}from'semantic-ui-react';import axios from'axios';import{authenticationService,authAxios}from'../services';import{useParams}from'react-router-dom';import ListPub from'../components/ListPub';import{api}from'../helpers/api';import{history}from'../helpers/history';var PubSection=function PubSection(){var _useState=useState(),_useState2=_slicedToArray(_useState,2),publication=_useState2[0],setPub=_useState2[1];var _useState3=useState(true),_useState4=_slicedToArray(_useState3,2),loading=_useState4[0],setLoading=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),error=_useState6[0],setError=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isSubscribed=_useState8[0],setIsSubscribed=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),buttonActive=_useState10[0],setButtonActive=_useState10[1];var _useState11=useState(''),_useState12=_slicedToArray(_useState11,2),IconSubName=_useState12[0],setIconSubName=_useState12[1];var params=useParams();var paramsSection=params['pubsection'];var setSubscriptionIcon=function setSubscriptionIcon(res){if(res.data.results.length!==0){setPub(res.data.results);setIsSubscribed(res.data.results[0].is_subscribed);if(res.data.results[0].is_subscribed){setIconSubName('close');}else{setIconSubName('signup');}}else{setPub(null);}};function fetchData(){return _fetchData.apply(this,arguments);}function _fetchData(){_fetchData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var ax,res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setLoading(true);_context.prev=1;ax=axios;if(authenticationService.isAuthenticated){ax=authAxios;}_context.next=6;return ax.get(\"http://127.0.0.1:8000/\".concat(params['pubsection']));case 6:res=_context.sent;setSubscriptionIcon(res);setLoading(false);_context.next=16;break;case 11:_context.prev=11;_context.t0=_context[\"catch\"](1);console.log(_context.t0.message);setError(_context.t0.message);setLoading(false);case 16:case\"end\":return _context.stop();}}},_callee,null,[[1,11]]);}));return _fetchData.apply(this,arguments);}useEffect(function(){fetchData();},[paramsSection]);function handleSubscription(){if(authenticationService.isAuthenticated){if(publication[0].is_subscribed){authAxios.delete(\"\".concat(api.pub.base,\"subscription/\").concat(isSubscribed)).then(function(res){setButtonActive(true);setIconSubName('window minimize');}).catch(function(err){console.log(err);setError(err.message);});}else{authAxios.post(\"\".concat(api.pub.base,\"createSubscription/\"),{\"column\":params['pubsection']}).then(function(res){setButtonActive(true);setIconSubName('checkmark');}).catch(function(err){console.log(err);setError(err.message);});}}else{history.push('/login');window.location.reload(false);}}return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Header,{as:\"h1\"},\" \",params['pubsection'],publication&&/*#__PURE__*/React.createElement(Button,{disabled:buttonActive,onClick:handleSubscription},/*#__PURE__*/React.createElement(Button.Content,{visible:true},/*#__PURE__*/React.createElement(Icon,{name:IconSubName})))),publication?/*#__PURE__*/React.createElement(ListPub,{publications:publication}):loading?/*#__PURE__*/React.createElement(Loader,{active:true,inline:\"centered\"}):/*#__PURE__*/React.createElement(Message,null,\"No publications available at the moment... Please try again later\"),error&&/*#__PURE__*/React.createElement(Message,{negative:true},\" \",error,\" \"));};export default PubSection;","map":{"version":3,"sources":["/Users/clintonm/Desktop/FS_PROJECT/TheSunNews/backend/thesunnews/frontend/thesunnews/src/containers/PubSection.js"],"names":["React","useEffect","useState","Header","Message","Button","Icon","Loader","axios","authenticationService","authAxios","useParams","ListPub","api","history","PubSection","publication","setPub","loading","setLoading","error","setError","isSubscribed","setIsSubscribed","buttonActive","setButtonActive","IconSubName","setIconSubName","params","paramsSection","setSubscriptionIcon","res","data","results","length","is_subscribed","fetchData","ax","isAuthenticated","get","console","log","message","handleSubscription","delete","pub","base","then","catch","err","post","push","window","location","reload"],"mappings":"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","sourcesContent":["import 'antd/dist/antd.css'\nimport React, {useEffect, useState} from 'react'\nimport {Header, Message, Button, Icon, Loader} from 'semantic-ui-react'\nimport axios from 'axios'\nimport {authenticationService, authAxios} from '../services'\nimport {useParams} from 'react-router-dom'\nimport ListPub from '../components/ListPub'\nimport {api} from '../helpers/api'\nimport {history} from '../helpers/history'\n\n\nconst PubSection = () => {\n  const [publication, setPub] = useState()\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState(null)\n  const [isSubscribed, setIsSubscribed] = useState(false)\n  const [buttonActive, setButtonActive] = useState(false)\n  const [IconSubName, setIconSubName] = useState('')\n  const params = useParams()\n  const paramsSection = params['pubsection']\n\n  const setSubscriptionIcon = (res) => {\n    if (res.data.results.length !== 0) {\n        setPub(res.data.results)\n        setIsSubscribed(res.data.results[0].is_subscribed)\n        if (res.data.results[0].is_subscribed) {\n            setIconSubName('close')\n        } else {\n            setIconSubName('signup')\n        }\n    } else {\n        setPub(null)\n    }   \n  }\n\n  async function fetchData() {\n    setLoading(true);\n    try {\n        let ax = axios\n        if (authenticationService.isAuthenticated){\n            ax = authAxios\n        }\n        const res = await ax.get(`http://127.0.0.1:8000/${params['pubsection']}`);\n        setSubscriptionIcon(res)\n        setLoading(false)\n    } catch (err) {\n        console.log(err.message)\n        setError(err.message)\n        setLoading(false)\n    } \n  }\n\n  useEffect(() => {\n        fetchData()\n    }, [paramsSection])\n  \n    function handleSubscription() {\n        if (authenticationService.isAuthenticated) {\n            if (publication[0].is_subscribed) {\n                authAxios.delete(`${api.pub.base}subscription/${isSubscribed}`)\n                .then(res => {\n                    setButtonActive(true)\n                    setIconSubName('window minimize')\n                }).catch(err => {\n                    console.log(err)\n                    setError(err.message)})    \n            } else {\n                authAxios.post(`${api.pub.base}createSubscription/`, \n                {\n                    \"column\": params['pubsection'],\n                }\n                ).then(res => {\n                    setButtonActive(true)\n                    setIconSubName('checkmark')\n                }).catch(err => {\n                    console.log(err)\n                    setError(err.message)\n                })}\n        } else {\n            history.push('/login')\n            window.location.reload(false)\n        }\n    }\n\n  return(\n    <div>\n        \n        <Header as='h1'> {params['pubsection']} \n            {publication && (\n                <Button disabled={buttonActive} onClick={handleSubscription}>\n                    <Button.Content visible>\n                        <Icon name={IconSubName} />\n                    </Button.Content>\n                </Button> \n                )} \n        </Header>\n            {publication ?\n            <ListPub publications={publication}/> : \n            loading ? <Loader active inline='centered' /> :\n            (<Message>No publications available at the moment... Please try again later</Message>)\n            }\n      {error && <Message negative> {error} </Message>}\n     </div>\n  )\n}\nexport default PubSection;"]},"metadata":{},"sourceType":"module"}