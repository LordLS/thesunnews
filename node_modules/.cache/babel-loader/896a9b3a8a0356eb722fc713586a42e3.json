{"ast":null,"code":"import _regeneratorRuntime from\"/Users/clintonm/Desktop/FS_PROJECT/TheSunNews/backend/thesunnews/frontend/thesunnews/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/clintonm/Desktop/FS_PROJECT/TheSunNews/backend/thesunnews/frontend/thesunnews/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/clintonm/Desktop/FS_PROJECT/TheSunNews/backend/thesunnews/frontend/thesunnews/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useRef,useState,useEffect}from'react';import{Button,Form,Header,Message}from'semantic-ui-react';import{history}from'../helpers/history';import{api}from'../helpers/api';import MarkdownIt from'markdown-it';import MdEditor from'react-markdown-editor-lite';import{authenticationService,authAxios}from'../services';import'react-markdown-editor-lite/lib/index.css';import{Redirect}from'react-router-dom';var mdParser=new MarkdownIt();var CreatePubForm=function CreatePubForm(){var _useState=useState(true),_useState2=_slicedToArray(_useState,2),isWriter=_useState2[0],setIsWriter=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),choiceSections=_useState4[0],setChoiceSections=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),title=_useState6[0],setTitle=_useState6[1];var _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),section=_useState8[0],setSection=_useState8[1];var _useState9=useState(''),_useState10=_slicedToArray(_useState9,2),content=_useState10[0],setContent=_useState10[1];var _useState11=useState(true),_useState12=_slicedToArray(_useState11,2),loading=_useState12[0],setLoading=_useState12[1];var _useState13=useState(null),_useState14=_slicedToArray(_useState13,2),error=_useState14[0],setError=_useState14[1];var _useState15=useState(''),_useState16=_slicedToArray(_useState15,2),thumbnail=_useState16[0],setThumbnail=_useState16[1];var fileInputRef=useRef();function fetchData(){return _fetchData.apply(this,arguments);}function _fetchData(){_fetchData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setLoading(true);_context.prev=1;_context.next=4;return authAxios.get(\"\".concat(api.pub.base,\"createpub/\"));case 4:res=_context.sent;setChoiceSections(res.data.results[0].available_sections);setIsWriter(res.data.results[0].is_writer);setLoading(false);_context.next=14;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](1);setError(_context.t0.message);setLoading(false);case 14:case\"end\":return _context.stop();}}},_callee,null,[[1,10]]);}));return _fetchData.apply(this,arguments);}useEffect(function(){if(authenticationService.isAuthenticated){fetchData();}},[]);function handleFormSubmit(e){e.preventDefault();var formData=new FormData();formData.append('thumbnail',thumbnail);formData.append('title',title);formData.append('content',content);formData.append('section',section);authAxios.post(api.pub.list,formData,{headers:{\"Content-Type\":\"multipart/form-data\"}}).then(function(res){setLoading(true);history.push('/');window.location.reload(false);console.log(res);}).catch(function(err){console.log(err);setError(err);});}function handleEditorChange(_ref){var html=_ref.html,text=_ref.text;setContent(text);}if(isWriter==false){return/*#__PURE__*/React.createElement(Redirect,{to:\"/\"});}return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Header,{as:\"h2\"},\"Create Publication Form\"),error&&/*#__PURE__*/React.createElement(Message,{negative:true},/*#__PURE__*/React.createElement(Message.Header,null,\"There was some errors with your submission\"),error.message),/*#__PURE__*/React.createElement(\"div\",{style:{textAlign:'left'}},/*#__PURE__*/React.createElement(Form,{onSubmit:handleFormSubmit},/*#__PURE__*/React.createElement(Form.Field,{value:section,onChange:function onChange(e){return setSection(e.target.value);},label:\"Section\",control:\"select\"},/*#__PURE__*/React.createElement(\"option\",{value:\"\"},\"---\"),choiceSections&&choiceSections.map(function(x){return/*#__PURE__*/React.createElement(\"option\",{key:x,value:x},x);})),/*#__PURE__*/React.createElement(Form.Field,null,/*#__PURE__*/React.createElement(\"label\",null,\"Title\"),/*#__PURE__*/React.createElement(\"input\",{value:title,onChange:function onChange(e){return setTitle(e.target.value);},placeholder:\"Title\"})),/*#__PURE__*/React.createElement(Form.Field,null,/*#__PURE__*/React.createElement(\"label\",null,\"Content\"),/*#__PURE__*/React.createElement(MdEditor,{style:{height:\"500px\"},renderHTML:function renderHTML(text){return mdParser.render(text);},onChange:handleEditorChange})),/*#__PURE__*/React.createElement(Form.Field,null,thumbnail?/*#__PURE__*/React.createElement(\"input\",{disabled:true,value:thumbnail.name}):'',/*#__PURE__*/React.createElement(Button,{type:\"button\",onClick:function onClick(){return fileInputRef.current.click();},content:\"Upload a thumbnail\",labelPosition:\"left\",icon:\"image\"}),/*#__PURE__*/React.createElement(\"input\",{onChange:function onChange(e){return setThumbnail(e.target.files[0]);},ref:fileInputRef,type:\"file\",hidden:true})),/*#__PURE__*/React.createElement(Button,{primary:true,loading:loading,disabled:loading,fluid:true,type:\"submit\"},\"Submit\"))));};export default CreatePubForm;","map":{"version":3,"sources":["/Users/clintonm/Desktop/FS_PROJECT/TheSunNews/backend/thesunnews/frontend/thesunnews/src/components/CreatePubForm.js"],"names":["React","useRef","useState","useEffect","Button","Form","Header","Message","history","api","MarkdownIt","MdEditor","authenticationService","authAxios","Redirect","mdParser","CreatePubForm","isWriter","setIsWriter","choiceSections","setChoiceSections","title","setTitle","section","setSection","content","setContent","loading","setLoading","error","setError","thumbnail","setThumbnail","fileInputRef","fetchData","get","pub","base","res","data","results","available_sections","is_writer","message","isAuthenticated","handleFormSubmit","e","preventDefault","formData","FormData","append","post","list","headers","then","push","window","location","reload","console","log","catch","err","handleEditorChange","html","text","textAlign","target","value","map","x","height","render","name","current","click","files"],"mappings":"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","sourcesContent":["import React, { useRef, useState, useEffect } from 'react'\nimport {\n  Button,\n  Form,\n  Header,\n  Message\n} from 'semantic-ui-react'\nimport {history} from '../helpers/history'\nimport {api} from '../helpers/api'\nimport MarkdownIt from 'markdown-it'\nimport MdEditor from 'react-markdown-editor-lite'\nimport {authenticationService, authAxios} from '../services'\nimport 'react-markdown-editor-lite/lib/index.css';\nimport { Redirect } from 'react-router-dom'\n\n\n\nconst mdParser = new MarkdownIt(/* Markdown-it options */);\n\nconst CreatePubForm = () => {\n    const [isWriter, setIsWriter] = useState(true)\n    const [choiceSections, setChoiceSections] = useState()\n    const [title, setTitle] = useState('')\n    const [section, setSection] = useState('')\n    const [content, setContent] = useState('')\n    const [loading, setLoading] = useState(true)\n    const [error, setError] = useState(null)\n    const [thumbnail, setThumbnail] = useState('')\n    const fileInputRef = useRef()\n\n\n    async function fetchData() {\n        setLoading(true);\n        try {\n            const res = await authAxios.get(`${api.pub.base}createpub/`);\n            setChoiceSections(res.data.results[0].available_sections)\n            setIsWriter(res.data.results[0].is_writer)\n            setLoading(false)\n        } catch (err) {\n            setError(err.message)\n            setLoading(false)\n        } \n      }\n\n    useEffect(() => {\n        if(authenticationService.isAuthenticated){\n          fetchData()\n        }\n    }, [])  \n\n    function handleFormSubmit(e) {\n        e.preventDefault();\n        const formData = new FormData()\n        formData.append('thumbnail', thumbnail)\n        formData.append('title', title)\n        formData.append('content', content)\n        formData.append('section', section)\n        authAxios.post(api.pub.list, formData, {\n            headers: {\n                \"Content-Type\": \"multipart/form-data\"\n            }}).then(res => {\n                setLoading(true)\n                history.push('/')\n                window.location.reload(false)\n                console.log(res)\n            }).catch(err => {\n                console.log(err)\n                setError(err)\n            })\n    }\n\n    function handleEditorChange({html, text}) { \n        setContent(text)  \n      }\n\n    if (isWriter == false){\n        return <Redirect to='/'/>\n    }\n\n    return(\n        <div>\n            <Header as='h2'>Create Publication Form</Header>\n            {error && \n            <Message negative>\n                <Message.Header>There was some errors with your submission</Message.Header>\n                {error.message}\n                </Message>}\n            <div style={{textAlign: 'left'}}>\n                <Form onSubmit={handleFormSubmit}>\n                <Form.Field value={section} onChange={e=> setSection(e.target.value)} label='Section' control='select'>\n                    <option value=''>---</option>\n                    {choiceSections && choiceSections.map(x => <option key={x} value={x}>{x}</option> )}\n                </Form.Field>\n                <Form.Field>\n                    <label>Title</label>\n                    <input value={title} onChange={e => setTitle(e.target.value)} placeholder='Title' />\n                </Form.Field>\n                <Form.Field>\n                <label>Content</label>\n                <MdEditor\n                    style={{ height: \"500px\" }}\n                    renderHTML={(text) => mdParser.render(text)}\n                    onChange={handleEditorChange}\n                        />\n                </Form.Field>\n                <Form.Field>\n                    {thumbnail?<input disabled value={thumbnail.name}/>:''}\n                    <Button type='button'onClick={() => fileInputRef.current.click()} content='Upload a thumbnail' labelPosition='left' icon='image'/>\n                    <input onChange={e => setThumbnail(e.target.files[0])}ref={fileInputRef} type='file' hidden />\n                </Form.Field>\n                <Button primary loading={loading} disabled={loading} fluid type='submit'>Submit</Button>\n                </Form>\n        </div>   \n    </div>\n    )\n}\n\nexport default CreatePubForm\n"]},"metadata":{},"sourceType":"module"}